# ğŸš€ Guide de DÃ©ploiement - Capsule Selfie

## ğŸ“‹ PrÃ©requis

### Outils NÃ©cessaires
- **Node.js**: v18 ou supÃ©rieur
- **npm**: v9 ou supÃ©rieur
- **Ionic CLI**: `npm install -g @ionic/cli`
- **Android Studio**: Pour le dÃ©veloppement Android
- **Xcode**: Pour le dÃ©veloppement iOS (Mac uniquement)

### VÃ©rification des installations
```bash
node --version
npm --version
ionic --version
```

---

## ğŸ”§ Installation Initiale

### Ã‰tape 1: Cloner/Naviguer vers le projet
```bash
cd /chemin/vers/votre/projet
```

### Ã‰tape 2: Installer les dÃ©pendances npm
```bash
npm install
```

### Ã‰tape 3: Installer les plugins Capacitor
```bash
npm install @capacitor/camera@latest
npm install @capacitor/geolocation@latest
npm install @capacitor/preferences@latest
npm install @capacitor/app@latest
```

### Ã‰tape 4: Installer Leaflet pour la carte
```bash
npm install leaflet@latest
npm install --save-dev @types/leaflet@latest
```

### Ã‰tape 5: Ajouter les plateformes
```bash
# Android
ionic cap add android

# iOS (Mac uniquement)
ionic cap add ios
```

---

## ğŸŒ Test sur Navigateur Web

### Lancement du serveur de dÃ©veloppement
```bash
ionic serve
```

### Limitations en mode web:
- âŒ CamÃ©ra native non disponible (utilise l'API web)
- âŒ GÃ©olocalisation peut nÃ©cessiter HTTPS
- âœ… Interface fonctionnelle
- âœ… Navigation testable
- âœ… Carte Leaflet fonctionnelle

### URL de test:
```
http://localhost:8100
```

---

## ğŸ“± Configuration Android

### Ã‰tape 1: Configuration AndroidManifest.xml

Chemin: `android/app/src/main/AndroidManifest.xml`

Ajouter les permissions (voir artifact android_manifest):
```xml
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.INTERNET" />
```

### Ã‰tape 2: CrÃ©er file_paths.xml

Chemin: `android/app/src/main/res/xml/file_paths.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <external-files-path name="my_images" path="/" />
    <external-path name="external_files" path="." />
    <cache-path name="my_cache_images" path="/" />
</paths>
```

### Ã‰tape 3: Synchroniser le projet
```bash
ionic cap sync android
```

### Ã‰tape 4: Build et tester
```bash
# Ouvrir dans Android Studio
ionic cap open android

# Ou directement depuis CLI
ionic cap run android -l --external
```

### Configuration Android Studio:
1. SÃ©lectionner un Ã©mulateur ou connecter un appareil
2. Activer le mode dÃ©veloppeur sur l'appareil
3. Cliquer sur Run (â–¶ï¸)

### Tester les permissions:
1. Lancer l'app
2. Aller sur "Prendre une photo"
3. Accepter permission camÃ©ra
4. Accepter permission localisation
5. Prendre une photo
6. VÃ©rifier dans la galerie

---

## ğŸ Configuration iOS

### Ã‰tape 1: Configuration Info.plist

Chemin: `ios/App/App/Info.plist`

Ajouter les descriptions de permissions (voir artifact ios_infoplist):
```xml
<key>NSCameraUsageDescription</key>
<string>L'application a besoin d'accÃ©der Ã  la camÃ©ra...</string>

<key>NSLocationWhenInUseUsageDescription</key>
<string>L'application a besoin de votre localisation...</string>
```

### Ã‰tape 2: Synchroniser le projet
```bash
ionic cap sync ios
```

### Ã‰tape 3: Ouvrir dans Xcode
```bash
ionic cap open ios
```

### Ã‰tape 4: Configuration dans Xcode
1. SÃ©lectionner le projet "App" dans le navigateur
2. Onglet "Signing & Capabilities"
3. SÃ©lectionner votre Ã©quipe Apple Developer
4. VÃ©rifier le Bundle Identifier

### Ã‰tape 5: Tester
1. SÃ©lectionner un simulateur ou appareil
2. Cliquer sur Run (â–¶ï¸)
3. **Note**: Les simulateurs iOS n'ont pas de camÃ©ra rÃ©elle

### Tester sur appareil physique iOS:
1. Connecter l'iPhone/iPad via USB
2. Faire confiance Ã  l'ordinateur sur l'appareil
3. SÃ©lectionner l'appareil dans Xcode
4. Run

---

## ğŸ—ï¸ Build Production

### Build Web
```bash
ionic build --prod

# Les fichiers sont dans www/
```

### Build Android (APK)

#### Via Android Studio:
1. `Build > Build Bundle(s) / APK(s) > Build APK(s)`
2. L'APK sera dans `android/app/build/outputs/apk/`

#### Via ligne de commande:
```bash
cd android
./gradlew assembleDebug
# APK dans: app/build/outputs/apk/debug/
```

#### Pour release (signÃ©):
```bash
./gradlew assembleRelease
```

### Build iOS (IPA)

#### Via Xcode:
1. Product > Archive
2. Une fois archivÃ©: Distribute App
3. Choisir mÃ©thode (App Store, Ad Hoc, etc.)

---

## ğŸ§ª Tests et Debugging

### Chrome DevTools pour Android
```bash
# Connecter appareil Android en USB
# Sur Chrome desktop: chrome://inspect
```

### Safari Web Inspector pour iOS
```bash
# Sur Mac: Safari > Develop > [Votre iPhone]
```

### Logs Natifs

#### Android (Logcat):
```bash
# Via Android Studio: Logcat tab
# Ou via adb:
adb logcat | grep "Capacitor"
```

#### iOS (Console):
```bash
# Via Xcode: View > Debug Area > Console
```

### Commandes utiles:
```bash
# Nettoyer le projet
ionic cap sync
ionic build
ionic cap copy

# RÃ©installer les dÃ©pendances
rm -rf node_modules package-lock.json
npm install
ionic cap sync
```

---

## ğŸ› RÃ©solution des ProblÃ¨mes Courants

### ProblÃ¨me: "Camera permission denied"
**Solution**:
1. VÃ©rifier AndroidManifest.xml / Info.plist
2. DÃ©sinstaller et rÃ©installer l'app
3. VÃ©rifier paramÃ¨tres appareil

### ProblÃ¨me: "Geolocation not working"
**Solution**:
1. Activer GPS sur l'appareil
2. Donner permission dans paramÃ¨tres de l'app
3. Tester en extÃ©rieur (meilleure rÃ©ception)

### ProblÃ¨me: Carte ne s'affiche pas
**Solution**:
1. VÃ©rifier connexion Internet
2. VÃ©rifier console pour erreurs Leaflet
3. S'assurer que leaflet.css est importÃ© dans angular.json

### ProblÃ¨me: Photos ne se sauvegardent pas
**Solution**:
1. VÃ©rifier Capacitor Preferences installÃ©
2. Effacer cache: `ionic cap sync`
3. VÃ©rifier logs pour erreurs de stockage

### ProblÃ¨me: Build Ã©choue
**Solution**:
```bash
# Nettoyer complÃ¨tement
rm -rf node_modules platforms plugins www
npm install
ionic build
ionic cap sync
```

### ProblÃ¨me: Permissions ne se demandent pas
**Solution**:
1. DÃ©sinstaller l'app complÃ¨tement
2. VÃ©rifier configuration native (AndroidManifest/Info.plist)
3. RÃ©installer: `ionic cap run android/ios`

---

## ğŸ“Š Checklist de Test

### Tests Fonctionnels:

#### Page d'Accueil âœ…
- [ ] Navigation vers camÃ©ra
- [ ] Navigation vers galerie
- [ ] Navigation vers carte
- [ ] Statistiques s'affichent correctement

#### Page CamÃ©ra âœ…
- [ ] Bouton de capture fonctionne
- [ ] Permission camÃ©ra demandÃ©e
- [ ] Permission localisation demandÃ©e
- [ ] Photo capturÃ©e s'affiche
- [ ] MÃ©tadonnÃ©es correctes (date, coordonnÃ©es)
- [ ] Navigation vers galerie

#### Galerie âœ…
- [ ] Photos s'affichent en grille
- [ ] Filtres fonctionnent (toutes/aimÃ©es/localisÃ©es)
- [ ] Like/Unlike fonctionne
- [ ] Suppression avec confirmation
- [ ] Modal de dÃ©tails s'ouvre
- [ ] FAB navigation vers camÃ©ra

#### Modal Photo âœ…
- [ ] Image en grand format
- [ ] Informations dÃ©taillÃ©es
- [ ] Like/Unlike
- [ ] Suppression
- [ ] "Voir sur carte" (si gÃ©olocalisÃ©e)
- [ ] Fermeture

#### Carte âœ…
- [ ] Carte s'affiche avec tuiles
- [ ] Marqueurs pour photos gÃ©olocalisÃ©es
- [ ] Marqueur utilisateur
- [ ] Popups sur marqueurs
- [ ] Centrage sur position utilisateur
- [ ] Navigation vers modal photo
- [ ] Vue liste alternative

#### Permissions âœ…
- [ ] Alerte si camÃ©ra refusÃ©e
- [ ] Alerte si localisation refusÃ©e
- [ ] Message pour ouvrir paramÃ¨tres
- [ ] App continue si localisation refusÃ©e
- [ ] Alertes rÃ©pÃ©tÃ©es si nÃ©cessaire

---

## ğŸ“ˆ Performance

### Optimisations AppliquÃ©es:
- âœ… Lazy loading des pages
- âœ… Standalone components
- âœ… Images en webPath (pas de duplication)
- âœ… Stockage optimisÃ© (JSON)

### MÃ©triques Ã  surveiller:
- Temps de chargement initial
- Temps de capture photo
- Temps d'affichage de la carte
- Taille de l'APK/IPA

---

## ğŸ“¦ Distribution

### Google Play Store (Android)

1. **CrÃ©er un compte dÃ©veloppeur Google Play**
2. **GÃ©nÃ©rer un keystore signÃ©**:
```bash
keytool -genkey -v -keystore my-release-key.keystore \
  -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000
```

3. **Configurer gradle pour signature**:
Fichier: `android/app/build.gradle`

4. **Build release**:
```bash
cd android
./gradlew bundleRelease
```

5. **Upload sur Google Play Console**

### Apple App Store (iOS)

1. **CrÃ©er un compte Apple Developer**
2. **CrÃ©er App ID dans Apple Developer Portal**
3. **Xcode: Product > Archive**
4. **Organizer > Distribute App**
5. **Soumettre pour review**

---

## ğŸ”„ Mise Ã  Jour

### Pour mettre Ã  jour l'app:

```bash
# 1. Modifier le code
# 2. IncrÃ©menter version dans package.json et config.xml
# 3. Build
ionic build --prod

# 4. Sync
ionic cap sync

# 5. Build natif et publier
```

---

## ğŸ“ Notes Importantes

### SÃ©curitÃ©:
- Ne jamais commit les keystores
- Utiliser variables d'environnement pour secrets
- Tester les permissions sur appareils rÃ©els

### Performance:
- Compresser les images si stockage devient lourd
- Limiter le nombre de photos si nÃ©cessaire
- Optimiser les marqueurs sur la carte

### AccessibilitÃ©:
- Tester avec TalkBack (Android)
- Tester avec VoiceOver (iOS)
- VÃ©rifier contrastes

---

## ğŸ“ Ressources Utiles

- [Documentation Ionic](https://ionicframework.com/docs)
- [Documentation Capacitor](https://capacitorjs.com/docs)
- [Guide Android](https://developer.android.com/guide)
- [Guide iOS](https://developer.apple.com/documentation)
- [Leaflet Docs](https://leafletjs.com/reference.html)

---

**Bonne chance pour votre projet ! ğŸš€**
